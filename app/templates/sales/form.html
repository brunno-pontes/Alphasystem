{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Registrar Nova Venda</h2>
    <a href="{{ url_for('cashier.dashboard') }}" class="btn btn-info">
        <i class="fas fa-cash-register"></i> Controle de Caixa
    </a>
</div>

<form method="POST" action="{{ url_for('sales.new_sale') }}">
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="product_id" class="form-label">Produto</label>
                <select class="form-control" id="product_id" name="product_id" required>
                    <option value="">Selecione um produto</option>
                    {% for product in products %}
                    <option value="{{ product.id }}" data-price="{{ product.price }}" data-quantity="{{ product.quantity }}">
                        {{ product.name }} - R$ {{ "%.2f"|format(product.price) }} (Estoque: {{ product.quantity }})
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="quantity" class="form-label">Quantidade</label>
                <input type="number" class="form-control" id="quantity" name="quantity" min="1" value="1" required>
            </div>
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label">Preço Unitário: <span id="unit-price">R$ 0.00</span></label><br>
        <label class="form-label">Preço Total: <span id="total-price">R$ 0.00</span></label>
    </div>
    <div class="mb-3">
        <button type="submit" class="btn btn-success">
            <i class="fas fa-shopping-cart"></i> Registrar Venda
        </button>
        <a href="{{ url_for('sales.list_sales') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const productSelect = document.getElementById('product_id');
        const quantityInput = document.getElementById('quantity');
        const unitPriceSpan = document.getElementById('unit-price');
        const totalPriceSpan = document.getElementById('total-price');

        function updatePrices() {
            const selectedOption = productSelect.options[productSelect.selectedIndex];
            if (selectedOption.value) {
                const price = parseFloat(selectedOption.getAttribute('data-price'));
                const quantity = parseInt(quantityInput.value) || 0;
                const total = price * quantity;

                unitPriceSpan.textContent = 'R$ ' + price.toFixed(2);
                totalPriceSpan.textContent = 'R$ ' + total.toFixed(2);
            } else {
                unitPriceSpan.textContent = 'R$ 0.00';
                totalPriceSpan.textContent = 'R$ 0.00';
            }
        }

        productSelect.addEventListener('change', updatePrices);
        quantityInput.addEventListener('input', updatePrices);

        // Inicializar valores
        updatePrices();
    });
</script>
{% endblock %}